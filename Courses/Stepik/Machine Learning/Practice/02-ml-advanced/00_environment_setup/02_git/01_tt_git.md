# Base Git

Официальный туториал находится [тут](https://git-scm.com/book/ru/v2) (для тех кто хочет тщательнее разобраться с тем как все работает)

Git - распределенная система контроля версий. Т.е. вся история изменений в проекте хранится у каждого разработчика. Однако при этом обычно используется удаленный репозиторий, который позволяет делиться информацией в удобном виде и хранить ее на выделенном сервере (помимо компьютеров разработчиков).
В нашем случае в качестве удаленного сервера будет использоваться GitHub.

## Установка Git

### Debian/Ubuntu/Mint

Откройте терминал, напишите команду и нажмите Enter, чтобы её выполнить:

```shell
sudo apt-get install git
```

## Основные команды

Обязательная к прочтению статья про состояния файла

`git init` - данная команда инициализирует в текущей папке git репозиторий. В частности создает скрытую директорию .git По сути ваш локальный репозиторий хранится в этой директории.

`git config` - после первой установки гита необходимо обязательно указать кто вы. Т.е. написать ваше имя и фамилию, а также email, чтобы другие разработчики и вы сами могли видеть, кто сделал те или иные изменения.

```shell
git config --global user.name "John Doe"
git config --global user.email johndoe@example.com
```

`git status` - Основной инструмент, используемый для определения, какие файлы в каком состоянии находятся

`git add` - используется для того чтобы начать отслеживать (добавить под версионный контроль) новый файл.
Но не все файлы стоит хранить в репозитории, например:

```shell
.idea/ - настройки вашей IDE
target/ - результаты сборки вашего проекта (большие бинарные файлы, которые можно собрать "на месте")
*.class - об этом позже
*.jar - об этом позже
````

Чтобы такие файлы или папки не попали в репозиторий и не просились постоянно в индексацию, нужно добавить их в `.gitignore`. Все что попало в этот файл будет игнорироваться системой контроля версий

Добавить все в текущей директории: `git add .`.

Добавить все изменения, которые видит git: `git add -A`.

Добавить изменения в конкретном файле: `git add src/some/dir/file.txt`.

Зафиксировать изменения в текущем индексе: `git commit`.

Запомните, всё, что до сих пор не проиндексировано — любые файлы, созданные или изменённые вами, и для которых вы не выполнили git add после момента редактирования — не войдут в этот коммит. Они останутся изменёнными файлами на вашем диске.

Зафиксировать изменения с заданным сообщением: `git commit -m "New function added"`.

Изменить сообщение последнего коммита: `git commit --amend`.

Просмотр истории всех коммитов: `git log`.

```text
git log
commit 1357c1a526f62dd008e70a5dcc8f19daf280a574
Author: Pavel Lazarenko <pavel.lazarenko@7bits.it>
Date:   Fri Sep 7 23:05:13 2018 +0600

    New function added
```

В данном случае `1357c1a526f62dd008e70a5dcc8f19daf280a574` - это уникальный номер коммита, т.е. внесенных вами изменений.

## Работа с ветками

Информация про ветки обязательная к прочтению тут
Изначально в репозитории находится только ветка master

Создание новой локальной ветки: `git branch pl/feature-loader`

Удаление ветки локально: `git branch -D pl/feature-loader`

Просмотр локальных веток: `git branch`

Просмотр всех веток: `git branch -a`

Переход в ветку: `git checkout pl/feature-loader`

Создание ветки и переход в нее: `git checkout -b pl/new-feature-loader`

Слияние изменений из ветки branch1 в ветку master:

```shell
git checkout master
git merge branch1
```

Если не будет конфликтов, которые бы не смог разрешить git самостоятельно, то слияние пройдет успешно. Иначе придется явно указать какую версию изменений стоит принять при конфликте, добавить их в индекс и зафиксировать.

Отменить процесс слияния на этапе разрешения конфликтов можно командой: `git merge --abort`

## Работа с удаленным репозиторием

О работе с удаленными репозиториями - желательно к прочтению.

Скачать и слить вашу ветку branch1 с веткой branch1 в удаленном репозитории:

```shell
git checkout branch1
git pull origin branch1
```

`origin` — это имя по умолчанию, которое Git присваивает серверу, с которого вы склонировали репозиторий.
Чтобы получить изменения, но не сливать пока с текущей веткой - используйте команду `git fetch`

Чтобы посмотреть, какому URL соответствует сокращённое имя в Git, можно указать команду: `git remote -v`

Чтобы опубликовать свои локальные изменения из ветки branch1 в удаленном репозитории, выполните команду:

```shell
git checkout branch1
git push origin branch1
```

## Gitlab

В нашем случае Gitlab будет выступать в роли удаленного сервера.

Для вас преподаватели уже создали аккаунт и специальные репозитории в [gitlab.7bits.it](https://gitlab.7bits.it/).

В ваших репозиториях у вас будет заблокирована ветка master. Поэтому работайте в ветках.

Чтобы начать работать с вашим репозиорием вам нужно:

1. Сгенерировать ssh ключ (если вы не делали этого ранее)
2. Добавить ssh ключ в профиль на Gitlab (если не делали этого ранее).
3. Склонировать репозиторий к себе на компьютер. Ссылка на репозиторий выглдяит обычно так: `ssh://git@gitlab.7bits.it:2222/ml/ml-courses/ml-course.git`.

### Создание SSH ключа

1. открываем терминал
2. Вставляем в терминал строку `ssh-keygen -t rsa -b 4096 -C "your_email@example.com"`. Заменить email на свой! Нажимаем enter и видим текст `Generating public/private rsa key pair.`
3. Вас попросят выбрать путь, где сохранить ключ. Оставляйте настройки по-умолчанию. `Enter a file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]`
4. Вас попросят ввести пароль. Это пароль ключа ssh, а не профиля на github или отпочты. Вы можете его оставить пустым, но лучше задайте пароль.
```shell
Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]
```
5. Выполните команду `eval "$(ssh-agent -s)"`.
6. Активируйте свой ssh ключ командой`ssh-add -K ~/.ssh/id_rsa`.

В итоге у вас в папке `~/.ssh` появится приватный и публичный ключи. Они необходимы, чтобы подтверждать вашу личность. Поэтому никогда и никому не показывайте и не передавайте свой приватный ключ. Его знаете только вы и тем самым подтверждаете, что вы это вы. А вот `id_rsa.pub` можно выдавать кому угодно, потому что ваш публичный ключ используется всеми серверами для старта процесса аутентификации.

### Добавление SSH ключа в Gitlab аккаунт

Поместите содержимое файла `id_rsa.pub` в соответсвтвующий раздел вашего аккаунта. Про это написано в [гайде от gitlab](https://docs.gitlab.com/ee/ssh/#adding-an-ssh-key-to-your-gitlab-account).

## Итоги

Цикл вашей работы описан в документе WORKFLOW.md. Прочитайте его.
